!function(a){a.isScrollToFixed=function(b){return!!a(b).data("ScrollToFixed")},a.ScrollToFixed=function(b,c){function u(){f.trigger("preUnfixed.ScrollToFixed"),B(),f.trigger("unfixed.ScrollToFixed"),o=-1,l=f.offset().top,m=f.offset().left,d.options.offsets&&(m+=f.offset().left-f.position().left),-1==n&&(n=m),g=f.css("position"),e=!0,-1!=d.options.bottom&&(f.trigger("preFixed.ScrollToFixed"),z(),f.trigger("fixed.ScrollToFixed"))}function v(){var a=d.options.limit;return a?"function"==typeof a?a.apply(f):a:0}function w(){return"fixed"===g}function x(){return"absolute"===g}function y(){return!(w()||x())}function z(){if(!w()){var a=f[0].getBoundingClientRect();p.css({display:f.css("display"),width:a.width,height:a.height,"float":i}),cssOptions={"z-index":d.options.zIndex,position:"fixed",top:-1==d.options.bottom?D():"",bottom:-1==d.options.bottom?"":d.options.bottom,"margin-left":"0px"},d.options.dontSetWidth||(cssOptions.width=a.width),f.css(cssOptions),f.addClass(d.options.baseClassName),d.options.className&&f.addClass(d.options.className),g="fixed"}}function A(){var a=t.offset(),b=v()-a.top,c=m-a.left;d.options.removeOffsets&&(c="",b-=l),cssOptions={position:"absolute",top:b,left:c,"margin-left":"0px",bottom:""},d.options.dontSetWidth||(cssOptions.width=f[0].getBoundingClientRect().width),f.css(cssOptions),p.css("display",f.css("display")),g="absolute"}function B(){y()||(o=-1,p.css("display","none"),f.css({"z-index":k,width:"",position:h,left:"",top:j,"margin-left":""}),f.removeClass("scroll-to-fixed-fixed"),d.options.className&&f.removeClass(d.options.className),g=null)}function C(a){a!=o&&(f.css("left",m-a),o=a)}function D(){var a=d.options.marginTop;return a?"function"==typeof a?a.apply(f):a:0}function E(){if(a.isScrollToFixed(f)&&!f.is(":hidden")){var b=e,c=y();e?y()&&(l=f.offset().top,m=f.offset().left):u();var g=s.scrollLeft(),i=s.scrollTop(),j=v();d.options.minWidth&&s.width()<d.options.minWidth?y()&&b||(G(),f.trigger("preUnfixed.ScrollToFixed"),B(),f.trigger("unfixed.ScrollToFixed")):d.options.maxWidth&&s.width()>d.options.maxWidth?y()&&b||(G(),f.trigger("preUnfixed.ScrollToFixed"),B(),f.trigger("unfixed.ScrollToFixed")):-1==d.options.bottom?j>0&&i>=j-D()?c||x()&&b||(G(),f.trigger("preAbsolute.ScrollToFixed"),A(),f.trigger("unfixed.ScrollToFixed")):i>=l-D()?(w()&&b||(G(),f.trigger("preFixed.ScrollToFixed"),z(),o=-1,f.trigger("fixed.ScrollToFixed")),C(g)):y()&&b||(G(),f.trigger("preUnfixed.ScrollToFixed"),B(),f.trigger("unfixed.ScrollToFixed")):j>0?i+s.height()-f.outerHeight(!0)>=j-(D()||-F())?w()&&(G(),f.trigger("preUnfixed.ScrollToFixed"),"absolute"===h?A():B(),f.trigger("unfixed.ScrollToFixed")):(w()||(G(),f.trigger("preFixed.ScrollToFixed"),z()),C(g),f.trigger("fixed.ScrollToFixed")):C(g)}}function F(){return d.options.bottom?d.options.bottom:0}function G(){var a=f.css("position");"absolute"==a?f.trigger("postAbsolute.ScrollToFixed"):"fixed"==a?f.trigger("postFixed.ScrollToFixed"):f.trigger("postUnfixed.ScrollToFixed")}var d=this;d.$el=a(b),d.el=b,d.$el.data("ScrollToFixed",d);var g,h,i,j,k,e=!1,f=d.$el,l=0,m=0,n=-1,o=-1,p=null,s=a(window),t=a(f[0].offsetParent),H=function(){f.is(":visible")&&(e=!1,E())},I=function(){window.requestAnimationFrame?requestAnimationFrame(E):E()},K=function(a){a=a||window.event,a.preventDefault&&a.preventDefault(),a.returnValue=!1};d.init=function(){d.options=a.extend({},a.ScrollToFixed.defaultOptions,c),k=f.css("z-index"),d.$el.css("z-index",d.options.zIndex),p=a("<div />"),g=f.css("position"),h=f.css("position"),i=f.css("float"),j=f.css("top"),y()&&d.$el.after(p),s.bind("resize.ScrollToFixed",H),s.bind("scroll.ScrollToFixed",I),"ontouchmove"in window&&s.bind("touchmove.ScrollToFixed",E),d.options.preFixed&&f.bind("preFixed.ScrollToFixed",d.options.preFixed),d.options.postFixed&&f.bind("postFixed.ScrollToFixed",d.options.postFixed),d.options.preUnfixed&&f.bind("preUnfixed.ScrollToFixed",d.options.preUnfixed),d.options.postUnfixed&&f.bind("postUnfixed.ScrollToFixed",d.options.postUnfixed),d.options.preAbsolute&&f.bind("preAbsolute.ScrollToFixed",d.options.preAbsolute),d.options.postAbsolute&&f.bind("postAbsolute.ScrollToFixed",d.options.postAbsolute),d.options.fixed&&f.bind("fixed.ScrollToFixed",d.options.fixed),d.options.unfixed&&f.bind("unfixed.ScrollToFixed",d.options.unfixed),d.options.spacerClass&&p.addClass(d.options.spacerClass),f.bind("resize.ScrollToFixed",function(){p.height(f.height())}),f.bind("detach.ScrollToFixed",function(a){K(a),f.trigger("preUnfixed.ScrollToFixed"),B(),f.trigger("unfixed.ScrollToFixed"),s.unbind("resize.ScrollToFixed",H),s.unbind("scroll.ScrollToFixed",I),f.unbind(".ScrollToFixed"),p.remove(),d.$el.removeData("ScrollToFixed")}),H()},d.init()},a.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},a.fn.scrollToFixed=function(b){return this.each(function(){new a.ScrollToFixed(this,b)})}}(jQuery);